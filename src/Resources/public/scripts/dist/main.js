var OnOfficeImport;(()=>{var e={243:(e,t,s)=>{"use strict";s.r(t),s.d(t,{OnOfficeImport:()=>r});class o{constructor(e,t){this.name=e,this.element=t,this.elements={form:this.element.querySelector("form"),buttons:{import:this.element.querySelector('button[type="submit"]'),settings:this.element.querySelector('button[type="button"]')},blocks:{settings:this.element.querySelector(".settings"),progress:this.element.querySelector(".progress")},progress:{current:this.element.querySelector(".progress .current"),number:this.element.querySelector(".progress .count"),info:this.element.querySelector(".progress .info"),bar:this.element.querySelector(".progress-value")}},this.data=null}hasSettings(){return!!this.elements.form}start(){this.elements.buttons.import.disabled=!0,this.elements.blocks.progress.style.display="block",this.elements.progress.info.classList.remove("success","error"),this.setStatus({message:"Retrieve data...",count:0,countAbsolute:0,simulateProgress:0}),this.hasSettings()&&(this.data=new FormData(this.elements.form),this.elements.buttons.settings.classList.remove("open"),this.elements.blocks.settings.classList.remove("open")),this.fetch().then((e=>this.onFinish())).catch((e=>this.onError(e)))}async fetch(){const e=await fetch("/onoffice/fetch/"+this.name,{method:"POST",body:this.data}),t=await e.json();this.setStatus(t),t.task&&this.countAbsolute&&await this.import(t.task)}async import(e){const t=await fetch(e.action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();this.setStatus(s),s.task&&this.countAbsolute&&await this.import(s.task)}setStatus(e){e.message&&(this.elements.progress.info.innerText=e.message),(e.countAbsolute||0===e.countAbsolute)&&(this.countAbsolute=e.countAbsolute,this.elements.progress.number.innerText=e.countAbsolute),(e.count||0===e.count)&&(this.elements.progress.current.innerText=e.count),this.countAbsolute&&e.count&&this.setProgress(e.count/this.countAbsolute*100),(e.simulateProgress||0===e.simulateProgress)&&this.setProgress(e.simulateProgress)}setProgress(e){this.elements.progress.bar.style.width=e+"%"}onFinish(){this.setProgress(100),this.elements.progress.info.classList.add("success"),this.elements.buttons.import.disabled=!1}onError(e){this.elements.progress.info.innerText="Import failed",this.elements.progress.info.classList.add("error"),console.error(this.name,e)}}class r{constructor(e){this.modules={};for(const t of document.querySelectorAll("[data-module]"))if(!t.classList.contains("disabled")){const s=t.dataset.module,r=new o(s,t);r.elements.buttons.import.addEventListener("click",(t=>{t.preventDefault(),confirm(e.texts.confirmMessage)&&(r.hasSettings()&&r.elements.form.checkValidity()?r.start():(r.elements.blocks.settings.classList.add("open"),r.elements.buttons.settings.classList.add("open"),r.elements.form.reportValidity()))})),r.hasSettings()&&r.elements.buttons.settings.addEventListener("click",(e=>{e.preventDefault(),r.elements.blocks.settings.classList.toggle("open"),r.elements.buttons.settings.classList.toggle("open")})),this.modules[s]=r}}}},36:(e,t,s)=>{const{OnOfficeImport:o}=s(243);e.exports=o}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o=s(36);OnOfficeImport=o})();